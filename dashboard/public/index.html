<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Ø³Ø±Ø§Ø¬ â€” Ù„ÙˆØ­Ø© Ø£Ø³Ø·ÙˆØ±ÙŠØ©</title>
<style>
body{font-family:system-ui,Segoe UI,Arial;margin:18px;background:#0f172a;color:#e6eef8}
h1{color:#7dd3fc}
table{width:100%;border-collapse:collapse;margin-top:12px}
td,th{padding:8px;border-bottom:1px solid rgba(255,255,255,0.06)}
button{padding:6px 10px;border-radius:6px;border:0;background:#06b6d4;color:#021124;cursor:pointer}
.log{background:#071129;padding:8px;border-radius:6px;margin-top:8px;height:200px;overflow:auto;font-family:monospace}
.online{color:#22c55e}
.stopped{color:#ef4444}
.errored{color:#facc15}
</style>
</head>
<body>
<h1>ðŸŸ£ Ù„ÙˆØ­Ø© Ø³Ø±Ø§Ø¬ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©</h1>
<div id="info">Ø§Ù„Ø§ØªØµØ§Ù„...</div>
<table id="tbl"><thead><tr><th>ID</th><th>NAME</th><th>STATUS</th><th>CPU</th><th>MEM(MB)</th><th>RESTARTS</th><th>UPTIME</th><th>ACTION</th></tr></thead><tbody></tbody></table>
<h3>Ø³Ø¬Ù„ Ù…Ø¨Ø§Ø´Ø±</h3>
<div id="logs" class="log"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const s = io();
const info = document.getElementById('info');
const tbody = document.querySelector('#tbl tbody');
const logs = document.getElementById('logs');

s.on('connect', ()=> info.textContent='âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ù„ÙˆØ­Ø©');
s.on('error', e=> info.textContent='âš ï¸ '+e);

s.on('status', list=>{
  tbody.innerHTML='';
  list.forEach(a=>{
    const tr = document.createElement('tr');
    const uptime_ms=a.uptime_ms||0;
    const s_ = Math.floor(uptime_ms/1000)%60;
    const m_ = Math.floor(uptime_ms/60000)%60;
    const h_ = Math.floor(uptime_ms/3600000);
    const uptime_str=`${h_.toString().padStart(2,'0')}:${m_.toString().padStart(2,'0')}:${s_.toString().padStart(2,'0')}`;
    tr.innerHTML=`<td>${a.id}</td><td>${a.name}</td><td class="${a.status}">${a.color} ${a.status}</td><td>${a.cpu}%</td><td>${a.memory}</td><td>${a.restarts}</td><td>${uptime_str}</td><td><button data-name="${a.name}">Restart</button></td>`;
    tbody.appendChild(tr);
  });

  document.querySelectorAll('button[data-name]').forEach(b=>{
    b.onclick=()=>{
      const name=b.getAttribute('data-name');
      b.disabled=true;
      s.emit('restart', name, resp=>{
        b.disabled=false;
        if(resp && resp.error) alert('Ø®Ø·Ø£: '+resp.error);
      });
    };
  });
});

s.on('log', d=>{
  const line=document.createElement('div');
  const ts=new Date().toLocaleTimeString();
  line.textContent=`[${ts}] ${d.name}: ${d.log.replace(/\n/g,'')}`;
  logs.appendChild(line);
  logs.scrollTop=logs.scrollHeight;
});
</script>
</body>
</html>
